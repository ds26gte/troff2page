Last change 2015-09-26

2015 Sept 26

.TH within .TS/.TE

2015 Sept 25

.break .continue

2015 Sept 24

.while

.do

2015 Sept 23

allow parens and spaces within them in arithmetic
expressions. Recognize <? and >?

.nop

-man-style SH and SS defined only for docs known to be -man

2015 Sept 22

\B'...'

Diversion should be retrievable several times.

execute-macro on a diversion should sent it back to input
stream.

Diversion should be callable as string.

2015 Mar 25

Don't do ToC in troff2page.lisp. Move it to a .tmac file.

2015 Mar 19

When first arg of .char is a Unicode escape (\[uXXXX]), make
sure the corresponding Unicode cha gets translated
correctly.

Added string-macro \*[urlh ...].

2014 Aug 22

index.tmac: makeindex has a bug: It won't accept files that
start with a dot! Added workaround.

2013 Sep 2

Allow \h'|...'. Reported by David B. Cortarello.

Support for \f(CB and .fam. By David B. Cortarello.

2011 Nov 25

peek-char in read-possible-troff2page-specific-escape should
not error on eof.  It is possible that a line ends in \
after an .eo.

2011 Nov 23

Don't assume that the .@SH that .SH refers to will be a
(troff2page) request.  It could have been redefined as a
macro.

2011 Oct 21

.LK: produce ToC lines for headers whose levels are <=
\n[GROWPS].

2010 Sep 22

url.tmac: No need for \*[urlh ...].  \*[url ...] can take 1
or 2 args.

.HTML .CDS .CDE; from www.tmac.

2010 Sep 19

SBCL: os-execute should return number indicating exit
status.

do-bye cannot use .blm because input port is already closed.

.nx can take an argument file.

\[uHHHH] is converted to &#xHHHH.  \u[uHHHH] is typically
used by the output of preconv -eutf8.

Mar 13, 2009

.pso should not expand escapes in its arg.  (All escapes, or
only some?)  In any case sed inside a .pso wasn't working
properly because \1 and \) were losing their backslash.

Mar 9, 2009

:external-format arg no longer needed when opening files in
CLISP.

Mar 8, 2009

Make .tm .tmc .sy .pso .writec .write much faster by using
Lisp output primitives instead of going thru the
string-traversing emit procedure.  (These might seem like
unlikely places to optimize, but they are used in the
indexing and eval macros.)

Accept .EQ's optional arguments (indent-style and eqno).

Use *groff-image-options* parameter to influence
magnification and font of .EQ and .PS.

Mar 7, 2009

Allow \\$\\n[numreg] inside macro/string body.

Mar 4, 2009

Call the code file troff2page.lisp, and have troff2page be a
softlink to it.

Mar 2, 2009

Specify charset in HTML file to UTF-8, so UTF-8 chars in
input file are rendered correctly in browsers, instead of
the ugly a-circumflex-euro-trademark trigraphs (?).

Feb 15, 2009

Clean up line processing to accommodate groff's new .lsm macro.

Feb 13, 2009

Line with all spaces (#spaces > 0) should also be treated as blank line
(i.e., .blm will trigger on that line).  Similarly for line
with \" preceded by spaces.  (ToDo: \# .  Is
*keep-newline-p* really needed?)

Feb 11, 2009

.IMG, .PIMG:  alignment argument, which would be the first,
is optional!

Feb 5, 2009

.in \n[.i]

Feb 1, 2009

For man .so, if filename arg in dir above is non-existent,
try in current dir also.  This accommodates .so'ing of aux
files created by troff2page.

Tested on Ubuntu.

Jan 31, 2009

Added support for CMUCL and ECL.

\V

Jan 29, 2009

For man pages, disable toc if only one .SH present.

Arg of .so in man is resolved from one directory above
current file.

Jan 28, 2009

Don't set body max-width in CSS unless user explicitly sets
\n[LL].

.EX/.EE

Move the booklet-style troff2page documentation file to troff2page.ms.
troff2page.1 and eval4troff.tmac.7 are man pages.

Jan 26, 2009

.rn

index.tmac: For nroff, disable index generation and loading
of index (if latter generated anyway via other calls).
Rationale: Any format for cross-refs is clunky; page numbers
may not be useful (esp. if we use a single long page); and
we might as well use text search on the resultant single
plain-text file.  N.B.  We still get proper indexes for
HTML, as troff2page, like troff, treats the n condition as
false.

Jan 25, 2009

Wasn't ignoring failing conditional clause (.if .ie .el) completely!

Jan 24, 2009

Recognize man.local as init file for man documents.

Jan 23, 2009

\*- should produce real em dash (not --)

Added number registers .c c. $$ .z .ce

Added current-time-related number registers: seconds minutes
hours dw dy mo year yr

Allowed for number register that calculates its value
procedurally each time it's queried.  Examples:
% .$ .F .u .  Such registers are always readonly.
(But not always in troff.  It's just not worth it to make %
(current-page-number) writable by the troff2page user.)

Jan 19, 2009

Added *verbatim-apostrophe-p* to control if ` ' `` '' should
show up like print-style quotes.  This doesn't have to be
set by user -- if " occurs in a non-monospace setting,
*verbatim-apostrophe-p* is set to t.  Rationale: If " is
used as a double quote (both left and right), then it
follows that ' should show up as an upright apostrophe, not
as a right quote (which would look typographically way too
upscale for the surroundings).

ms displays should set .u to 0.

Jan 18, 2009

For lines with leading spaces, but <Br> before, not after.
If line is first line of paragraph, no <Br> at all.  This
follows groff where a line with leading space does not have
a line-break at its end but melds into the following line
(if the latter starts flush left in the source).

Jan 15, 2009

.mso searches current directory after GROFF_TMAC_PATH and
before home.  (This is how groff works in unsafe mode.)

Dec 27, 2008

.sp produces <div> with appropriate vertical margin.

Dec 25, 2008

In documentation, use HSL (preferred by CSS) instead of HSV.

Dec 4, 2008

.DS I should use \n[DI] instead of \n[PI].  (Initially,
DI == PI.)

Dec 2, 2008

Don't call store-title if title (from .TL, say) is empty
string -- so title can default to more meaningful jobname.

.DS I should use \n[PI] to set margin-left, thus
distinguishing itself from .DS L.

Nov 28, 2008

Use the value of \n[LL] that's current when the first page
is cut to set .body max-width in CSS.

Nov 23, 2008

defhsv.tmac

.pso

<num>f  = <num> * 2^16

Nov 20, 2008

\M[] for background color.  Also: .gcolor and .fcolor. (NB:
groff -ms doesn't close these off at end of paragraph, but
troff2page does.)

Change the troff2page init file name to .troff2pagerc.tmac, so
it can be loaded as -m.troff2pagerc by troff.

Oct 22, 2008

.sp puts out as many <br>s as its argument.

.B .I etc weren't triggering font changes because
switch-font was called with argument with wrong case!
Fixed.  (I guess I tend to use the TeX-like \fB \fI etc, as
they don't interfere with how the text flows, hence didn't
notice.)

Take out ugly-br-hack-for-firefox, as it's an issue probably
only for block paragraphs, and that is not what we have by
default anymore (PI != 0,  PD almost 0).

Oct 20, 2008

eval4troff.tmac: make it work for heirloom troff.

Oct 18, 2008

.ce was centering one less line.

Oct 16, 2008

Spadework for future (when CSS3 target-counter works?): Put
in a hook \n[HTML1] that will eventually help generate a
single html page that is print-friendly.  Printing such a
page from a browser should produce something at least
rudimentarily similar to what groff/pdfroff would produce
from the same source.  However, this requires a bunch of
CSS3 coding to fix cross references (to real paperlike page
numbers now, even though it's all just one page to HTML).]

Use css to avoid vertical space for phantom navbar in header
when output is known to be a single page.

Avoid generating last-page-number warning for documents that
troff2page knows can only generate one HTML page (because it
didn't see a .bp).

Use the values of \n[PI] and \n[PD] to control how
paragraphs look in HTML also.  To use the browser's default
paragraph separation style, set \n[PD] less than 0.  (Make
this latter HTML-only, for troff will happily overstrike text
to respect a negative \n[PD].)

Oct 15, 2008

Use the value of \n[PS] that is current when the first page
is cut to set .body font-size in CSS.  (This doesn't quite
match how troff treats \n[PS], but since \n[PS] is typically set
at the preamble of the document, this is mostly OK.)

Oct 14, 2008

Treat \s0 correctly.  Also: allow font, color, and size
changes to intertwine correctly.

Allow l as a table (cell) format option.

Sept 29, 2008

t2p2info: Compensate for Info reducing multiple consecutive hyphens by one.

Sept 24, 2008

t2p2info: <h2> <h3> <h[4-6]> produce @unnumbered
@unnumberedsec @unnumberedsubsec @unnumberedsubsubsec
respectively.

Sept 14, 2008

More arithmetic operators: * / % <= >= == & :

Sept 12, 2008

Have t2p2info be an ex script.

Take out the clutter caused by emit-edit-source-doc for now.

Sept 11, 2008

Have mkdvipsnam be an ex (vim) script rather than a bash
script (for portability).

If \n[GROWPS] > 0, then use it and \n[PSINCR] to adjust
font-size of HTML headings.

.nr should read lengths too (converting them to points).

May 7, 2008

Remove Lisp special var to keep track of current source file
-- use troff register .F

Use emit-edit-source-doc to insert comments in HTML that can
help a text editor jump to correct location in source
document files.

April 28, 2008

Don't differentiate .NH (.SH) from .@NH (.@SH) for toc
entry purposes.  -Thtml doesn't.

April 27, 2008

.SH with empty heading text shouldn't generate toc entry

April 21, 2008

Recognize \h's length argument

April 20, 2008

.substring .length

.if d should expand its arg

index.tmac: Don't define .PX macro -- it may be used for sth
else.

.nr should expand-arg its second arg at least (after picking
up optional sign).

Allow all kinds of escapes in macro name in a macro call.

April 14, 2008

Allow arbitrary escaped sequences after .if and .ie instead
of just \n

April 11, 2008

.char

April 10, 2008

Clean up troff2page-help a bit.

April 8, 2008

Rewrite t2p2info to create texinfo file and then call
makeinfo.  This is because my hand-crafting the Indirection
and Tag Table doesn't seem to work on the Mac OS X version
of Info.

April 7, 2008

Dust off t2p2info.  Make index entries translate cleaner,
and convert the ToC into a menu.

April 6, 2008

Avoid configuration step in favor of depending on a single
environment variable LISP.

Avoid the deprecated <font> for font, color, and size
switching.  Use <span style=...> instead.  This also makes
such switching code unified.

Let .AU use italic by default as ms does, but allow user to
.am @AU (so it works for both groff and troff2page)

April 5, 2008

Track .TAG definition change in groff

Fix .am when adding macro to request.  This also required
read-args to be rewritten correctly, e.g., to
\\$* inside a macro body as separate words.

Differentiate .LP (and display enders) from .PP with CSS
class p.indent.

.shift  \$0

April 4, 2008

Don't have section headers point to ToC -- link decoration
is too heavy, plus we have links to ToC in the navbars
anyway.

Initialize \*[AUXF] in troff2page to a string that includes
jobname, so it's sufficiently peculiar.  Can't do this for
troff because latter has no concept of jobname.  But at
least this keeps the .tmac files clean from having to keep
track of two strings, one for troff and the other for
troff2page.

March 31, 2008

eval4troff.tmac: Impicit escape off (.eo), as in .ig ##.

No longer define \& \% \, \% as escapes producing the bogus
troff sequence \[htmlemptly].   Define them as glyph names
mapping to unicode #x200c (zwnj).  #x200b (zero-width space)
would probably be better, but lynx doesn't support it.

Include \: among the zero-spacers.

When attempting to expand escaped character \c, if c is
present in neither the *escape-table* nor the *glyph-table*,
simply output c.

March 30, 2008

Process .ig ## with an implicit escape off (.eo), so \ can
be used normally in the Lisp code.  It doesn't matter that
the escape is implicitly off for troff, because for the
latter .ig ## is just a comment.

eval4troff.tmac: Do not create for each .eval when it's
known that the Lisp file wasn't created.  Also, in this
case, each .eval should typeset some place-holding text
instead of nothing at all

.P1 .P2 when bell localisms on (set by call to .SC or by
defining numreg bell_localims)

March 29, 2008

collect-macro-body should expand-args the lines it reads
first before checking for ender.  Thus \.. reads as ..  But
\\.. (which could be used to end nested macro defs) does
not.

Before reading main file, read .troff2pagerc, if it exists
in GROFF_TMAC_PATH

Accept single-char glyph names (e.g., \0) instead of
treating them as escapes.  Cleaner.

Start adding glyph defs from groff_char(7).  No treatment of
composites yet.  For glyph names that groff_char(7)
translates as composites, use direct unicode transalation if
available.

March 28, 2008

Fix infinite loop for .blm set to a (user) .de macro.  Generally
clean up the process-line macro to be simpler.

Re-zero index page suffixes for every sub*item, not just for
item.  (Othewise suffixes get too profuse.)

March 27, 2008

Add glyphs != <= >= ~= ap ib ip sb sp

Treat format options for .TS/.TE.  Do at least as much as
htbl.awk does.

March 26, 2008

Ensure additions to *html-head* (via !header) get output in
the right order

Links to a page without mentioning a node needn't use a #

March 25, 2008

Include script mkdvipsnam that makes dvipsnam.tmac from
LaTeX's dvipsnam.def

modify .defcolor to use #, ##, and fractions of 65536.  also
all the schemes: rgb, cmy, cmyk, and gray

March 23, 2008

Ensure all output streams are closed when troff2page is
done.  Otherwise .eval doesn't work in SBCL.

.BX .B1 .B2 -- but use background gray instead of drawing a
box

Add :external-format arg (*external-format*, initialized to
charset:iso-8859-1) to all calls to file openers for CLISP,
so 8-bit ascii chars are copied verbatim to the output.
Without this, CLISP was either swallowing the characters or
erroring.

March 22, 2008

.PIMG, .IMG (from www.tmac)

March 20, 2008

Line starting with escape should set *previous-line-exec-p*
to nil.  This allows some lines within .ce to not join with
successive lines.

March 19, 2008

Make runnable on SBCL

Add configure.lisp to configure troff2page (and
eval4troff.tmac) for CL impls other than CLISP

March 18, 2008

Make runnable on Clozure CL.

Put troff2page code into a package.

Recognize www.tmac's .HX directive.

Feb 28 to March 17, 2008

Major rewrite of all the code.  Written only to run in
Common Lisp (CLISP) for now.  May add (R6RS) Scheme version
later when time permits.

Remove converters of HTML to info and vimhelp for now.  (Have
to adapt them to the rewrite.)

Dummy defs for \h \v

.sy sets \n[systat] to 0 if system call succeeds.

\{ \} \<newline> should be preserved in macro-copy mode.

The string used to end a macro def must be called as a
macro!

Numreg .U (set to 1 for troff2page).

Don't include code for indexing, cross-referencing and .eval
in troff2page Scheme code as the latter can process the
corresponding troff macros for such directly.  The macro
files are index.tmac, pagetag.tmac and eval4troff.tmac. Aux
file names are constructed from the string \*[AUXF], which,
if not set by the user, is set by these macro files to
.trofftemp.  It is a good idea to set \*[AUXF] to something
else, so different troff documents in the same directory
don't use the same aux files.  I could have had \*[AUXF]
initialized to something based on the jobname, but a troff
run cannot really reliably tell what its main file's name is.

(Note: The tmac files use \*[AUXF] to make slightly
different files for troff2page vs troff, but this is only
because the data (page numbers, and temp file counters, if
.if is used)) could be different for the two devices.  The
processing of the data in the aux files is pretty much the
same for both troff and troff2page, so most of the code is
reused.)

Clean up char-getting routines, and process-line.

Recognize .return.  Use a single fluid *exit-status* to deal
with .ex .ab .nx .return.

Treat .SH's optional level arg (as allowed by groff).
do-section now emits <hN> where N ranges from 1 to 6
according to level of section.

.SH should eat newline to prevent the latter from triggering
blank-line macro.

Footnotes on an HTML page were showing in reverse order.
(Didn't notice this before because only had at most one
footnote per page!)

Oct 22, 2005

Add some @media print rules in the generated CSS file.

June 3, 2005

prefs.tmac: Make footnote point-size and baselineskip same as for body
text.  Zero interparskip, but not for nroff.  Introduce
\n[aftersectionspace] (default .3v).

May 2, 2005

t2p2info: *notes in index page don't need link text.

May 1, 2005

eval-in-scheme: I think for now it doesn't need to double the slashes in
the Scheme code and halve them when reading its stdout.

Apr 28, 2005

.SS (man)

Apr 27, 2005

Keep t2p2info in the troff2page distribution but t2p2txt in the tex2page distribution.

Apr 23, 2005

Chicken config improved.  Suggest compilation procedure.

Apr 22, 2005

t2p2info: Show footnote marks more clearly.  Remove section header's
back-link to ToC as it looks too cluttered.  The Top node is where the ToC
is mostly, and users can jump to Top fairly easily.

Apr 21, 2005

eval4troff.tmac: Don't ask user to run Scheme/CL on ...-eval4troff.scm file
if the user already did so.

Apr 19, 2005

*string-table* should be initialized within the troff2page procedure, just
like *numreg-table*.  (This allows the troff2page proc to be called
correctly several times within the same Scheme session.)  So too with
*color-table*.

Add !macro-package aux directive.  (Also use global var *macro-package*
rather than *format*.  The latter is TeX usage.)

Macro files are searched for in user's home dir too, if not found anywhere
else on GROFF_TMAC_PATH.

Apr 16, 2005

HTML index: Reset exponent for each subitem, not just for the item.

Convert `` and '' to &[lr]dquo; but only if they are not in <tt>.

Apr 15, 2005

Add a shellmagic line for SBCL, and enable compile for CLISP.

Apr 14, 2005

Make prefs.tmac processable by both Scheme and Common Lisp.

Have eval4troff.tmac create a jobname.ext-eval4troff.scm that is loadable
by MzScheme, Guile and Common Lisp.

Allow Scheme to read jobname-Z-A.scm aux file created by Common Lisp.  (Not really
necessary, just a convenience for my own debugging.)

Use (c)leaner CLISP shell-magic line.

Apr 12, 2005

Fixes to Common Lisp configuration.

Apr 11, 2005

.mso.  Search in GROFF_TMAC_PATH, but ignore obvious groff-supplied files
like s.tmac, ms.tmac, www.tmac.

Apr 9, 2005

Diversions!  .di and .da

prefs.tmac: Redefine .; so that immediately following paragraph text is not
intended, unless there is more than one blank line separating it from the
no-fill text.  (Relevant only for print output.)

Various rewrites to make .eval process characters the same via both
troff2page and troff. (Tough!)

Apr 8, 2005

String treatment rewritten.

emit procedure: Treat specially \[html...] -- where \ is the literal
backslash, not the current escape-char.

read-word, read-quoted-phrase, read-bare-word: Should ignore <backslash><newline>.
Apr 7, 2005

prefs.tmac: Strings \*[url URL] and \*[urlh URL TEXT] defined.

Apr 6, 2005

Use a shell script `bibtroff' to generate targeted bibliographies from
bigbib.1.  Take out .BIB definition from prefs.tmac and have the generated
bib define it.

Apr 4, 2005

xref.tmac: Have the first .TG call, rather than cov*ab-init, load the .aux
file.  Avoids unnecessary failed loading of .aux file for documents that
don't use .TG.  Also: have .TG set the string immediately, so at least
backward references to it will work on the first groff run.

Apr 3, 2005

Allow groff-style strings, i.e., they can have args.

Follow unroff in making .ig ## ... .##  act like  .eval ... .endeval,
except the former happens only for troff2page.

Apr 2, 2005

Doublequote-enclosed strings cannot extend across newlines.  Assume they
end at first newline.

.DS and friends shouldn't use <table>s.  Wrong approach, try CSS later.
The <table>s cause too much vertical space too.

Load jobname.t2p before processing jobname.ext, if former exists.
jobname.t2p is a place to put fudgy definitions so that legacy troff
documents can be converted without changing them.

.nr: don't store if rval isn't a number.

\~ (translates to &nbsp;).

Add a "References" section to the doc.  Added a .BIB macro in prefs.tmac

collect-macro-body shouldn't set *macro-args*!  It looks like I have to set
*macro-copy-mode?* both during collect-macro-body and execute-macro.  Maybe
the variable is needed as used, but I misnamed it?

eval4troff.tmac: Wrap parts of .eval definition that need the troff escape
character in .ecs excursions, because user may have chosen to disable or
change the escape character in .eval code.

Redefine .@SH, instead of adding lines to .cov@ab-init to alias .SH to a
modified version.

Remove globals holding section and footnote numbers because we don't have
LaTeX-like \label's that need to refer to them.  Instead, add \*[SN-NO-DOT]
and \*[SN-DOT] (the latter produces the same as \*[SN]).

Use .LK instead of .TC for the HTML ToC.  (This is the name used by
www.tmac.)

.OLS, .OLE (from www.tmac).

Leave out </dt> and </dd> since we don't use closing tags for other cases where we don't need them.

troff2page.1: Use Scheme to figure out whether to use st, nd, rd, or th for the ordinal number representing the troff2page version.

All Fools' Day, 2005

Have .RS ... .RE translate to <blockquote>.

Treat Cygwin as 'unix, not 'windows.

t2pslides.tmac: Use .eval freely.  No need for keeping troff2page:...
variables.

Pare down the css file generated.  Contained quite a bit of tex2page-specific
stuff.

Don't create the top nav bar when the last page number still unknown.  This
avoids the minor irritant of the last page pointing to a fictitious (last +
1)th page immediately after the first run of troff2page.

.eval in xref.tmac autoloads eval4troff.tmac.

.ND takes entire line after it, not just first word.

Abstract out portion of the .writem translation as the procedure
write-troff-macro-to-port, so that it can be used in user's .eval's.

.eval should collect contents as troff but output them as HTML.

Mar 31, 2005

Paragraph macros should turn off nofill.

Allow text following .SH to be included in the header for -ms.
Doesn't hurt if there is nothing, and it is easy to redefine .SH to include
it for the print output (as prefs.tmac does).

Mar 30, 2005

.DC as defined in www.tmac.  Entirely thru CSS!

Added lots of advanced glyphs.  Use term "glyph" for what I used to call
"special" -- things like \(oe.  This seems to be more in line with modern
groff documentation.  (I think I used the term "special" because I saw it
in UTP?)

Mar 28, 2005

Have \(st and \[string] expand to themselves (and not the empty string) if
they didn't have a definition.  Avoids need for explicitly defining
\[htmllt], etc., to themselves, and also makes it easier to catch
undefinition errors.  troff does expand undefined specials to the empty
string, but let's not emulate that.

Use of advanced HTML entities.  Quotes look nicer with this but may
not be portable.

xref.tmac: Use .sy to automatically call makeindex.  Redefine .TG and .IX
so one doesn't need to mess with stderr.  (Of course this requires -U
mode.)

Keep only essential macros in xref.tmac.  The rest in prefs.tmac.  (I like
them, but others may not.)  Note also that troff2page has built-in
knowledge of the things in xref.tmac, so it doesn't need to load it.
However, it has to process prefs.tmac in order to perform the macros there.

Allow space after control-char and before macro name.

When ignoring .i[fe] multiline branch, eat newline after it

When reading \} that closes (a non-ignored) .i[fe] multiline branch, eat
newline after it.

No need to check if reading in "phase 1" when processing \{ and \}.
expand-escape already takes care to pass \{ and \} thru unmolested.

Mar 27, 2005

Documentation improvements!  Add sections for .eval, error recovery.

\*[nondefinedstring] should generate \[htmlempty] rather than emptystring.
This is to avoid the following obscure bug: A line starts with a
\*[nondefinedstring] followed by a period.  This is treated as a
nondefinedmacro call, which swallows up the line!

Correct implementation of .TG to match doc.   '.TG node value' creates an
anchor named "node" in HTML, and also binds the string \*[node] to value
across troff[2page] runs.  In HTML \*[node] becomes a link to node, in
addition to expanding to value.  If value is omitted, assume it to be
current page number.

Also, don't keep track of two names for the node, one the HTML anchor name,
and the other the troff string.  Just use the same string for both, and
have !label have one less arg.  Don't really need a *label-table* now, the
troff strings are enough info.

N.B.: troff2page pretends www.tmac's .TAG is eqv to .TG, even tho the
latter does more.  Maybe I should just call .TG .TAG, and provide a re-def
of .TAG in xref.tmac.

Added troff2info and troff2txt scripts.  (These are merely
(compose t2p2info troff2page) and (compose t2p2txt troff2page)
respectively.)  troff2info in particular is probably a desired combo.

Have *troff2page-version* be a number (e.g., 20050327), not a string.
Available as the troff number register \n[.troff2page].  Can be used to
write version-dependent documents if necessary.

Unknown if-test char should be treated as false.

Assume if-test of t to be true, since we consider n to be false.

Keep track of input line number for better error messages.  Also, when
crashing, offer to edit offending file at offending line number, like TeX
does.

Mar 26, 2005

\*[troff2page:title] refers to *title*

Stream troff2page:aux refers to *aux-port* (jobname-Z-A.scm)

Get rid of intermediate HTML quasi-entities like &htmllt; -- instead use
troff quasi-escapes like \[htmllt].  This makes for less bug-infested ways
of dealing with things as troff, whether for troff-like inspection or to
actual output to a non-HTML stream.  (Scheme would have been ideal, but
troff2page really keeps track of text as troff mostly.  Keeping track of it
as HTML, however half-heartedly, was wrong from the outset.)

Allow some extended arith expressions in conditionals

\*[troff2page:jobname] and \n[troff2page:last-page-number] defined so user
can manipulate them as troff variables

.eval ... .endeval doesn't disable or change escape char.  User can do it
explicitly with an enclosing .eo or .ec

Mar 25, 2005

\e is current escape char, not necessarily backslash

\(rs \(dq \(cq

Have stdout of .eval ... .endeval slurped back into troff source, as
opposed to having to deal with a separate *out* port.

Mar 23, 2005

\^  .HP

Man .SH header argument should lose enclosing quotes.

Treat man double-font macros (.RI, .BR, etc) correctly.

read-bare-word should not stop at "\ " (escaped space).

Mar 20, 2005

eval4troff.tmac -- .eval ...  .endeval

Clean up treatment of .ce -- it shouldn't need to call process-line on its
own.

On firefox at least, <div> causes a parsep-like vertical skip but </div>
doesn't, but only if the ambient font is the basefont.  Weird...  included
hack to deal with this somewhat.

Mar 19, 2005

t2p2info: Allow for the fact that the 'wc -c filename' output line begins
with some spaces on Solaris.

Treat '.blm undefined-macro' and '.blm' correctly.

.writec, .sy, .tmc, .ab.

Mar 17, 2005

Added .open, .close, .write, .writem.

Mar 16, 2005

roll troffxref script into xref.tmac

Mar 14, 2005

included scripts t2p2info and t2p2txt from tex2page.  (same scripts work
for html generated from either tex2page or troff2page.)

t2pslides.tmac, for HTML slides.

Mar 13, 2005

.evalq evaluates Scheme expression quietly (i.e., doesn't output anything
into document).

Create separate .css file again instead of embedding.

Treat .if \n[...]

\n[.u] (1 in fillmode, 0 in nofillmode)

.VB, .OL thrown out.

Feb 27, 2005

Include www.tmac in xref.tmac

June 13, 2004

Get rid of nroff- and image-based translations for .TS.  Commit to
translating tables into HTML <table>.

June 12, 2004

.TS translation cleaned up.  Added T{ and T}.

June 9, 2004

Embed default stylesheet instead of creating an auxiliary -Z- file.

May 31, 2004

.TG tagname value

binds \*[tagname] to value across runs.

If value is omitted, it's assumed to be current page number.

May 29, 2004

Let condition n be false for troff2page.

Rename troff2page.tmac to xref.tmac.

May 28, 2004

\~

.OL (obeylines macro)
.VB (.OL with monospace)

.ft works the same in both -man and -ms.

For -man, output ToC just before first .SH instead of immediately after
.TH.

May 6, 2004

.TS sets table in different ways depending on the value of
*table-style*, which should be one of {image, nroff, html}.

.TS option "center", "allbox", ...

May 5, 2004

Convert .TS/.TE to <table>.

\\$*

May 4, 2004

\#

Input lines are read in two phases, as in Oliver Laumann's unroff.

Apr 27, 2004

\%

Apr 26, 2004

.ec with no arg should set escape char to #\\.  Similarly,
.cc sets comment char to #\", and
.c2 sets no-break control char to #\'.

Apr 25, 2004

troff2page should recognize that ms's .TL, .SH, and .NH pick up
heading upto next par-reset.

troff2page.tmac's redefinitions of ms's .SH and .NH should also pick up
headings up to next par-reset, but it's OK that the ToC only mentions
the first line.  OK compromise I think.  (It seems prohibitively
difficult to capture text up to next par-reset, so that it can be used
twice, once for typesetting the header, and a second time to be stored
in the ToC.)

The following, until ***, fix bugs pointed out by Zvezdan Petkovic'.

.I etc can take third argument.

.I w e  --  Remember to put space after e!

\, \/

\<newline> shouldn't introduce &htmlempty; (I think).  It certainly
fails for constructs like

.el \
.ie ...

Inside a macro body, \\$n, where n is greater than number of args
supplied, should expand to "".

***

.ft

Apr 24, 2004

.LG .SM .NL

\*{...\*}  creates superscript.

Font and size changes should only persist until end of paragraph.

Apr 22, 2004

Treat space-generators (like .sp) and para-generators (like .PP) separately.
Only the later call .par@reset.

.par@reset

Apr 21, 2004

Throw out all the TeX-y label stuff from troff2page.tmac.

Use -ms's .IX macro directly.  I.e., don't redefine it.

Apr 8, 2004

Issue message if troff2page needs to be run again.  (See rejected note
for Apr 5, 2004.)  Possible missing pieces for which rerun is necessary
are: index, last-page, title.

.blm should take arguments that are requests instead of just macros.
This is only because we've defined many format macros as requests in
troff2page.  Probably a kludge?

\s (font size change).  Environments now keep track of size (just like
they do font style and color).

Apr 5, 2004

(Let troff2page internally process the input file a second time if
necessary to slurp in index and last page number.  REJECTED.  Thought
better of this Apr 8.  May revisit later.)

Process .PSPIC's alignment argument also.

Apr 4, 2004

Convert .PSPIC (from pspic.tmac).  (Using netpbm -- shouldn't I be using
ImageMagick?)

Don't have font switches in HTML's external title.

troff2page.tmac: Use -Z in aux file names, so they can be easily
identified as expendable.

Apr 3, 2004

Added .saneparsep to troff2page.tmac.  After calling this: (1) a blank
line in filled mode is a .PP, (2) a blank line in no-fill mode is a .br,
and (3) a .LP removes the paragraph indentation

.RT

Mar 30, 2004

Simplify redefinitions of .SH and .NH in troff2page.tmac to suit groff
1.19.1.

.NH with no arg is eqv to .NH 1.

.@NH is like .NH but doesn't generate toc entry.

Don't mention labels in the doc.

Aug 29, 2003

Treat blank line paragraph separators as
dot-lines, so <br> isn't inserted for initial-space
line immediately following.

Aug 27, 2003

Allow alphanumeric charseqs (either directly or as
numregs) after .if.  0 is false, all positive numbers
are true.  All negative numbers are for the moment
false because that's how groff and Solaris troff behave
although the groff doc suggests they should be true.
All other alphanumeric seqs not otherwise
specially recognized are false.

Font macros shouldn't introduce newline -- this causes
extra <br>s in non-fill environments.

Added conditionals: n (true), r, c, o, e.

Allow string-valued number registers (format = "s").
\n(.F is such a register.

Use \n(.F to determine the aux file used for
(print) cross-references, so the user doesn't have to keep
track of it.

Aug 26, 2003

s/LBL/L:/

Aug 25, 2003

Index hyperlinks used to mention just the (HTML) page
number.  Now add a differentiating superscript when the
same index item points to several locations on
the same page.

.af's 2d arg for zero-padding can contain any digit,
not just 0.

\n+ and \n-

Allow user to specify what .LBL should refer to.
With one argument, .LBL binds
points its label to the most recent section or footnote
number.  Given a second argument, .LBL assigns that
value to the label, and has any references to the label
to hyperlink to the .LBL's own location.

Aug 24, 2003

Tighten inter-group vertical spacing in HTML index.

Allow .LBL to refer to footnote numbers.

\n[nh*hl], \n%, \n[PN].

.tm, but write to stdout instead of stderr.

Aug 23, 2003

Use standard or quasi-standard names: s/TOC/TC/,
s/INDEX/PX/, s/BIB/BR/.

Include name as environment's field.  Use
environment for title text.  Allow initialization
when first creating an environment with a particular
name.

Aug 22, 2003

.af: Allow numreg formats i = lower-case roman), I
= upper-case roman, 0...0 = left-zero-padded, and a =
lower-case alpha.

Allow title macros .AU and .AI to be ended by .LP
(.AB/.AE doesn't need be present).

.URL can have "" as 2d argument followed a 3d arg, in
which case link-text is same as url.

troff2page.tmac doesn't source www.tmac.  Also ensure
that troff2page.tmac doesn't define www.tmac macros if
device is html (i.e., grohtml is being called).

Have section headers point to ToC.

Aug 21, 2003

.@SH equivalent to .SH but doesn't generate toc entry.

Redefine existing header macros .NH and .SH to generate
toc entries.

.-only input lines should be ignored.

.ND \*(DY

Aug 20, 2003

Recognize section number registers H1, H2, ....

.af.  E.g., for appendix sections, do

.nr H1 0
.af H1 A

Aug 19, 2003

Always generate ToC for man pages.

Aug 18, 2003

Treat blank lines and leading spaces on lines in the
middle of filled text correctly.

July 23, 2003

`\ ' should be (verbatim " ") instead of just " ".  The
latter causes the space to be eaten when it is read,
thrown back and read again as a word (because read-word
does ignore-spaces first).

Improved .AU .AI .AB .AE.  .TL still takes only one
following line as argument though -- because storing
indefinite number of lines for external title is
somewhat painful.  No big deal, as we can use
\newline for multiline titles -- but should fix.

.ex .ig

July 22, 2003

Numbered footnotes are hyperlinks.

July 21, 2003

.HBP generates page-break in HTML, no-op in print.

Generate a default css file.

July 15, 2003

added scmxlate config for Common Lisp (CLISP)

July 14, 2003

Fluid *reading-bare-word?* added.  This allows a macro
call to have a backslashed newline at the end or even
in the macro name.  This is standard troff behavior,
and it is indeed useful: Placing backslashed newlines
immediately at the end of a long bare word
prevents the text-editor's filling mechanism from
putting the bare word and the backslash on different
lines.

.BIB

July 13, 2003

Fleshed out doc.

.evc .als \0

.TAG, from www.tmac.  .URL #tag should correctly
resolve despite split output HTML pages.

.LBL (labels that refer to sections)

Navig bar shows contents and index, if available.

July 12, 2003

HTML does TOC

troff2page can make an HTML index now, using makeindex
(from TeX dist).

Added more macros to troff2page.tmac: .IX .SEC .USEC
.LBL .BR, so print version can the functionality that
the HTML version is getting

Added script troffxref that manipulates index, toc and
label information from jobname.aux.  Sorted index is made
in jobname.ind using makeindex, TOC is made in
jobname.toc, and label strings plus macros for loading
TOC and index (.TOC .INDEX) are put in jobname.xrf.
troffxref is print only.  troff2page can take care of
calling makeindex appropriately within Scheme.

July 3, 2003

\*[SN]

.ce

get-char shouldn't read ahead by a line, because
it will misread \" inside "..." as a comment.
read-word should be allowed to read \" embedded in
"...".  Such \" translate to literal double-quote.

Fixed read-arg-num bug reading $n when it is the last
thing in the input string

Added troff2page.bat

.if t

.em

Specials for Latin-1 chars

July 2, 2003

.FS/.FE produce numbered footnotes a la groff's ms,
if no footnote mark specified.  String \*[*]
updates and prints footnote number in text

Because of \*[*], strings can't be implemented as
(Scheme) strings anymore, but have to be thunks
that produce strings

\*[-] is em-dash

\ followed by newline followed by " ruins reading
of the double-quoted phrase because of intervening
&htmlempty; (inserted by \newline).  Corrected.

&htmlspace; added, to represent an HTML space that shouldn't
be made into &nsbp;

s/groff/troff as troff is the more general name, and
groff is a particular implementation of troff (?).

.RS/.RE

.ie .el

.if : issue error if opening character isn't
currently implemented.  Currently implemented chars
are:
#\" and #\' for string-equality;
#\! for negation

July 1, 2003

\e generates &htmlbackslash;.  Generating \
directly causes it to be retried as escaper later
on.

Improved newline-on-macro-line treatment.

\c

\&, \|, \newline shd generate "&htmlempty;"
so as to disable any following control character.
\c should _not_ generate &htmlempty;

Font macros different in man from ms.

process-line abstracted out of generate-html, as it is
used by some macros to process whole lines following
(can't rely on such lines to be non-macro-calls).

groff2page command takes --help, --version.  No
argument or argument that isn't a filename show
diagnostic.

environments (.ev)

.DS improved -- options L B C R I distinguished
appropriately.

June 30, 2003

Escape < > " & when creating HTML strings so they can
be distinguished from literal < > " & when time comes
to emit them into HTML file.

Removed special treatment of some escapes in
initial scan

expand-args was ignoring non-$ char after \

.nr.  For now, only values allowed are num, +num, -num.

defspecial added (for things like \[em], \[bu], etc)

Better .DS and friends

Allow for no request/macro to follow .
(because .\" is possible)

.eo

June 29, 2003

.DS/.DE .LD .ID .BD .CD .RD (not good definitions
for all though)

read-till-eol should not eat final newline
in initial scan

.I .B .C .CW .R

.ec .cc .c2 .fi .nf .defcolor

defescape (like defrequest, defstring)

\e \f (I, B, C, CW, P) \* \n comment-character (initially \") \&
\m

June 28, 2003

First public release

\*[.T]

\" \f \e

.CSS .HR .HTL .LASTMOD .LI .TAG .ULE .ULS .URL

.EQ/.EN .PS/.PE .TS/.TE

.AB/.AE .AU .FS/.FE .IP .LP .NH .PP .QP .QS/.QE .SH
(ms, man) .TH .TL .TP

.am .blm .bp .br .de .ds .if ('_'_') .nx .so

June 25, 2003

; vi:tw=60
